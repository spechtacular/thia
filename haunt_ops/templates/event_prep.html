{% extends "base.html" %}
{% load static %}
{% block title %}Prep – {{ user.get_full_name }}{% endblock %}

{% block content %}
  <div class="d-flex align-items-center mb-3">
    <strong class="me-3">Prep for {{ user.get_full_name }} on {{ event.event_name }}</strong>
    {% if user.image_url %}
      <img src="{% static 'people_pics/' %}{{ user.image_url }}"
           alt="Profile Picture"
           class="rounded-circle"
           style="width: 80px; height: 80px; object-fit: cover;">
    {% else %}
      <img src="{% static 'people_pics/default.jpg' %}"
           alt="Missing Profile Picture"
           class="rounded-circle"
           style="width: 80px; height: 80px; object-fit: cover;">
    {% endif %}
  </div>

  <p><strong>Event Date:</strong> {{ event.event_date|date:"d-m-Y" }}</p>
  <p>
    <strong>Slot Column:</strong> {{ ev_signup.slot_column|default:"None" }}
    &nbsp;|&nbsp;
    <strong>Slot Row:</strong> {{ ev_signup.slot_row|default:"None" }}
  </p>
  <p>
    <strong>Volunteer Slot:</strong>
    Start: {{ ev_signup.start_time|date:"H:i" }},
    End:   {{ ev_signup.end_time|date:"H:i" }}
  </p>

  <hr>

  <h2>Volunteer Prep Status</h2>
  <ul class="list-unstyled mb-4">
    <li><strong>Phone:</strong> {{ user.phone1 }}{% if user.phone2 %} / {{ user.phone2 }}{% endif %}</li>
    <li><strong>Date of Birth:</strong> {{ user.date_of_birth|date:"d-m-Y" }}</li>
    <li><strong>ICE Contact:</strong> {{ user.ice_name }} ({{ user.ice_relationship }}) – {{ user.ice_phone }}</li>
    <li><strong>Allergies:</strong> {{ user.allergies|default:"None" }}</li>
    <li><strong>Waiver Signed:</strong> {{ user.waiver|yesno:"Yes,No" }}</li>
    <li><strong>Under 16:</strong> {{ ev_signup.under_16|yesno:"Yes,No" }}</li>
  </ul>

  <h3>Update Prep Flags</h3>
  <form method="post" class="mb-4">
    {% csrf_token %}
    <div class="row">
      {% for field in form %}
        <div class="col-md-3 form-check mb-2">
          {{ field }}
          <label class="form-check-label" for="{{ field.id_for_label }}">
            {{ field.label }}
          </label>
        </div>
      {% endfor %}
    </div>
    <button type="submit" class="btn btn-primary">Save Prep Status</button>
  </form>

  <p><a href="{% url 'event_detail' event.pk %}">&laquo; Back to Event Detail</a></p>
{% endblock %}
