{% extends "base.html" %}
{% block title %}Event Volunteer Detail{% endblock %}

{% block content %}
  <strong>{{ event.event_name }}</strong>
  <p><strong>Date:</strong> {{ event.event_date|date:"m-d-Y" }}</p>

  <h2>Volunteers</h2>

  <!-- üîç Filter Form -->
  <form id="filter-form" class="mb-3 row g-2 align-items-center">
    <div class="col-auto">
      <label for="status-filter" class="form-label mb-0 fw-bold">Status:</label>
      <select id="status-filter" class="form-select form-select-sm" name="status">
        <option value="">-- All --</option>
        <option value="confirmed">Confirmed</option>
        <option value="signed_in">Signed In</option>
        <option value="confirmed_not_signed_in">Confirmed but not Signed In</option>
      </select>
    </div>

    <div class="col-auto">
      <label for="role-filter" class="form-label mb-0 fw-bold">Task:</label>
      <select id="role-filter" class="form-select form-select-sm" name="role">
        <option value="">-- All --</option>
        <option value="scare">Scare Actor</option>
        <option value="line">Line Entertainment</option>
      </select>
    </div>

    <div class="col-auto">
      <label for="prep-filter" class="form-label mb-0 fw-bold">Prep Missing:</label>
      <select id="prep-filter" class="form-select form-select-sm" name="prep">
        <option value="">-- All --</option>
        <option value="makeup">Needs Makeup</option>
        <option value="costume">Needs Costume</option>
      </select>
    </div>

    <div class="col-auto">
      <button type="button" id="clear-filter" class="btn btn-sm btn-outline-secondary">Clear All</button>
    </div>
  </form>


  <!-- üîÅ AJAX-loaded volunteer table -->
  <div id="volunteer-table">
    {% include "haunt_ops/partials/_volunteer_table.html" %}
  </div>

  <p><a href="{{ return_to }}">&laquo; Back</a></p>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  console.log("‚úÖ JS loaded");

  const statusFilter = document.getElementById("status-filter");
  const roleFilter = document.getElementById("role-filter");
  const prepFilter = document.getElementById("prep-filter");
  const clearBtn = document.getElementById("clear-filter");

  function fetchFilteredList() {
    const url = new URL(window.location.pathname, window.location.origin);
    url.searchParams.set("ajax", "1");

    if (statusFilter.value) url.searchParams.set("status", statusFilter.value);
    if (roleFilter.value) url.searchParams.set("role", roleFilter.value);
    if (prepFilter.value) url.searchParams.set("prep", prepFilter.value);

    console.log("üîÑ Fetching:", url.toString());

    fetch(url)
      .then(response => response.text())
      .then(html => {
        document.getElementById("volunteer-table").innerHTML = html;
      })
      .catch(error => {
        console.error("‚ùå AJAX failed:", error);
      });
  }

  statusFilter.addEventListener("change", fetchFilteredList);
  roleFilter.addEventListener("change", fetchFilteredList);
  prepFilter.addEventListener("change", fetchFilteredList);

  clearBtn.addEventListener("click", function () {
    statusFilter.value = "";
    roleFilter.value = "";
    prepFilter.value = "";
    fetchFilteredList();
  });

  // Optional: auto-fetch on page load with previous state
});
</script>
{% endblock %}

