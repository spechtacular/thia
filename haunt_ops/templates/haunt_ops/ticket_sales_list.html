{% extends "base.html" %}
{% load humanize tz %}

{% block title %}Ticket Sales — Total Sold: {{ total_tickets_sold|intcomma }}{% endblock %}

{% block content %}
<div class="container">
  <h1>Ticket Sales by Event Date
     <small class="text-muted">Total Sold: {{ total_tickets_sold|intcomma }}</small>
  </h1>

  {% if events_page.object_list %}
    <div class="table-responsive">
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th>Event</th>
            <th>Date</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th># Shows</th>
            <th>Tickets Purchased</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
            {% for e in events_page.object_list %}
                <tr>
                <td><a href="{% url 'ticket_sales_detail' e.pk %}">{{ e.event_name }}</a></td>
                <td>{{ e.event_date|date:"m-d-Y" }}</td>

                {% timezone "America/Los_Angeles" %}
                    <td>
                    {% if e.first_start_time %}
                        {{ e.first_start_time|date:"g:i a" }}
                    {% else %}
                        —
                    {% endif %}
                    </td>
                    <td>
                    {% if e.last_end_time %}
                        {{ e.last_end_time|date:"g:i a" }}
                    {% else %}
                        —
                    {% endif %}
                    </td>
                {% endtimezone %}

                <td>{{ e.total_shows|intcomma }}</td>
                <td>{{ e.total_purchased|default_if_none:0|intcomma }}</td>
                <td>
                    <a class="btn btn-primary btn-sm"
                        href="{% url 'event_detail' e.pk %}?return_to={{ request.get_full_path|urlencode }}">
                        View Event
                    </a>
                </td>
                </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>

    <nav aria-label="Pagination" class="pagination">
        <pre>page={{ events_page.number }} / {{ events_page.paginator.num_pages }}</pre>

      {% if events_page.has_previous %}
        <a class="previous_page" href="?page={{ events_page.previous_page_number }}">← Previous</a>
      {% else %}
        <span class="previous_page disabled" aria-disabled="true">← Previous</span>
      {% endif %}

      <em class="current" aria-current="page">
        Page {{ events_page.number }} of {{ events_page.paginator.num_pages }}
      </em>

      {% if events_page.has_next %}
        <a class="next_page" href="?page={{ events_page.next_page_number }}">Next →</a>
      {% else %}
        <span class="next_page disabled" aria-disabled="true">Next →</span>
      {% endif %}
    </nav>
  {% else %}
    <p>No ticket sales found.</p>
  {% endif %}
</div>
{% endblock %}
