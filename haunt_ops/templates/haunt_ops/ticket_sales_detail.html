{% extends "base.html" %}
{% load humanize %}

{% block title %}Ticket Sales â€“ {{ event.event_name }}{% endblock %}

{% block content %}
  <h1 class="h3 mb-3">Ticket Sales</h1>

  <div class="mb-3">
    <strong>{{ event.event_name }}</strong><br>
    <span>Date: {{ event.event_date|date:"D, M j, Y" }}</span><br>
    <a href="{% url 'event_detail' event.pk %}?return_to={{ request.get_full_path|urlencode }}">
        View volunteers for this event
    </a>
  </div>

  <div class="mb-3">
    <strong>Totals:</strong>
    Sold: {{ totals.total_purchased|default_if_none:0|intcomma }},
    Remaining: {{ totals.total_remaining|default_if_none:0|intcomma }}
  </div>

  {% if rows %}
    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle">
        <thead>
          <tr>
            <th style="min-width: 280px;">Event Name</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th class="text-end">Tickets Sold</th>
            <th class="text-end">Tickets Remaining</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.event_name }}</td>
            <td>{{ r.event_start_time|date:"Y-m-d H:i" }}</td>
            <td>{{ r.event_end_time|date:"Y-m-d H:i" }}</td>
            <td class="text-end">{{ r.tickets_purchased|default_if_none:0|intcomma }}</td>
            <td class="text-end">{{ r.tickets_remaining|default_if_none:0|intcomma }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>No ticket sales recorded for this event.</p>
  {% endif %}

  <p class="mt-3">
    <a href="{% url 'ticket_sales_list' %}">&laquo; Back to Ticket Sales</a>
  </p>
{% endblock %}
